<html>

<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body>

  <div class="container">
    <div class="row">
      <div class="col-6">
        <canvas id="canvas"></canvas>
      </div>
      <div class="col-6">
        <canvas id="canvasR"></canvas>
      </div>
    </div>




    <div class="col-6 form-group row">
      <label for="age-input" class="col-2 col-form-label">Current Age</label>
      <div class="col-10">
        <input class="form-control" type="number" value="35" id="age">
      </div>

      <label for="age-input" class="col-2 col-form-label">Years to Retirement</label>
      <div class="col-10">
        <input class="form-control" type="number" value="35" id="toRetire">
      </div>

      <label for="age-input" class="col-2 col-form-label">Years after Retirement</label>
      <div class="col-10">
        <input class="form-control" type="number" value="20" id="afterRetire">
      </div>

      <label for="age-input" class="col-2 col-form-label">Seed Fund</label>
      <div class="col-10">
        <input class="form-control" type="number" value="1000000" id="seed">
      </div>

      <label for="age-input" class="col-2 col-form-label">Monthly Saving</label>
      <div class="col-10">
        <input class="form-control" type="number" value="35000" id="mSaving">
      </div>

      <label for="age-input" class="col-2 col-form-label">Monthly Expenses</label>
      <div class="col-10">
        <input class="form-control" type="number" value="20000" id="mExpenses">
      </div>

      <label for="age-input" class="col-2 col-form-label">Expected Annual Return %</label>
      <div class="col-10">
        <input class="form-control" type="number" value="8" id="returnRate">
      </div>

    </div>
  </div>


  
  
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.min.js"></script>



  <script>


    let elementAge         = document.getElementById("age")
    let elementToRetire    = document.getElementById("toRetire")
    let elementAfterRetire = document.getElementById("afterRetire")
    let elementSeed        = document.getElementById("seed")
    let elementMonthSaving = document.getElementById("mSaving")
    let elementMonthExp    = document.getElementById("mExpenses")
    let elementreturnRate  = document.getElementById("returnRate")


    let age                = parseInt(elementAge.value);
    let toRetire           = parseInt(elementToRetire.value);
    let afterRetire        = parseInt(elementAfterRetire.value);
    let seed               = parseInt(elementSeed.value);
    let saving             = parseInt(elementMonthSaving.value) 
    let exp                = parseInt(elementMonthExp.value)
    let netSave            = 12 * (saving - exp)
    let returnRate         = 1 + parseInt(elementreturnRate.value) / 100.0

    let ageList            = Array.from({length: toRetire + afterRetire + 1}, (_, i) => i + age)
    let seedGrowth         = ageList.map(x => seed * returnRate**(x-age))
    let saveGrowthPart     = ageList.map(x => netSave * returnRate**(x-age))
    let saveGrowth         = saveGrowthPart.map((curr, i, array) => array.slice(0, i+1).reduce((a, b) => a + b, 0))

    function saveG(age, startAge, returnRate) {
      
    }
    

    let chartR = new Chart(document.getElementById("canvasR"), {
      type: 'line',
      data: {
        labels: ageList,
        datasets: [{ 
            data: seedGrowth,
            label: "Seed Growth",
            backgroundColor: 'rgba(0, 255, 0, 0.1)'
          },
          { 
            data: saveGrowth,
            label: "Expenses",
            backgroundColor: 'rgba(255, 0, 0, 0.3)'
          }
        ]
      },
      options: {
        tooltips: {
            callbacks: {
                label: function(tooltipItem, data) {
                    return Number(tooltipItem.yLabel/1000000).toFixed(2) + ' Million';
                }
            }
        }
      }
    });

    [elementAge, elementToRetire, elementAfterRetire, elementSeed, elementMonthSaving, elementMonthExp, elementreturnRate].map(e => e.addEventListener("change", rePlot))
    function rePlot() {
      console.log("hi")
      let age                = parseInt(elementAge.value);
      let toRetire           = parseInt(elementToRetire.value);
      let afterRetire        = parseInt(elementAfterRetire.value);
      let seed               = parseInt(elementSeed.value);
      let saving             = parseInt(elementMonthSaving.value) 
      let exp                = parseInt(elementMonthExp.value)
      let netSave            = 12 * (saving - exp)
      let returnRate         = 1 + parseInt(elementreturnRate.value) / 100.0

      let ageList            = Array.from({length: toRetire + afterRetire + 1}, (_, i) => i + age)
      console.log(ageList)
      let seedGrowth         = ageList.map(x => seed * returnRate**(x-age))
      let saveGrowthPart     = ageList.map(x => netSave * returnRate**(x-age))
      let saveGrowth         = saveGrowthPart.map((curr, i, array) => array.slice(0, i+1).reduce((a, b) => a + b, 0))

      chartR.data.labels = ageList
      chartR.data.datasets[0].data = seedGrowth
      chartR.data.datasets[1].data = saveGrowth
      chartR.update()
    }


    
    document.getElementById("age").addEventListener("change", myFunction)
    function myFunction() {
      let x = document.getElementById("age");
      
      chart.data.datasets[0].data = chart.data.datasets[0].data.map(_ => x.value * 100)
      chart.update()
    }

    

    
    
    
    let ctx = document.getElementById("canvas").getContext("2d");
    
    let chart = new Chart(document.getElementById("canvas"), {
      type: 'line',
      data: {
        labels: [1500,1600,1700,1750,1800,1850,1900,1950,1999,2050],
        datasets: [{ 
            data: [86,114,106,106,107,111,133,221,783,2478],
            label: "Africa",
            borderColor: "#3e95cd",
            fill: false
          }, { 
            data: [282,350,411,502,635,809,947,1402,3700,5267],
            label: "Asia",
            borderColor: "#8e5ea2",
            fill: false
          }, { 
            data: [168,170,178,190,203,276,408,547,675,734],
            label: "Europe",
            borderColor: "#3cba9f",
            fill: false
          }, { 
            data: [40,20,10,16,24,38,74,167,508,784],
            label: "Latin America",
            borderColor: "#e8c3b9",
            fill: false
          }, { 
            data: [6,3,2,2,7,26,82,172,312,433],
            label: "North America",
            borderColor: "#c45850",
            fill: false
          }
        ]
      },
      options: {
        title: {
          display: true,
          text: 'World population per region (in millions)'
        }
      }
    });
    
    </script>
    
    
    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
</body>


</html>
